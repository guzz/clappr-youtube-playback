!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("@guzzj/clappr-core")):"function"==typeof define&&define.amd?define(["@guzzj/clappr-core"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).YoutubePlayback=t(e.Clappr)}(this,(function(e){"use strict";function t(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function i(e,t){return(i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function n(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function a(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,a=r(e);if(t){var o=r(this).constructor;i=Reflect.construct(a,arguments,o)}else i=a.apply(this,arguments);return n(this,i)}}var o=function(e){var t={exports:{}};return e(t,t.exports),t.exports}((function(e){!function(t){var r={src:"https://www.youtube.com/iframe_api",loading:!1,loaded:!1,listeners:[],load:function(e){var r=this;if(this.listeners.push(e),this.loaded)setTimeout((function(){r.done()}));else if(!this.loading){this.loading=!0,t.onYouTubeIframeAPIReady=function(){r.loaded=!0,r.done()};var i=document.createElement("script");i.type="text/javascript",i.src=this.src,document.body.appendChild(i)}},done:function(){for(delete t.onYouTubeIframeAPIReady;this.listeners.length;)this.listeners.pop()(t.YT)}};e.exports?e.exports=r:t.YouTubeIframeLoader=r}(window)}));var s=".clappr-youtube-playback[data-youtube-playback] {\n  position: absolute;\n  height: 100%;\n  width: 100%;\n  display: block;\n}";!function(e,t){void 0===t&&(t={});var r=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],n=document.createElement("style");n.type="text/css","top"===r&&i.firstChild?i.insertBefore(n,i.firstChild):i.appendChild(n),n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}}(s);var u=/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/,l=function(r){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&i(e,t)}(y,r);var n,l,c,h=a(y);function y(e){var t;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,y),(t=h.call(this,e)).settings={changeCount:0,seekEnabled:!0,left:["playpause","position","duration"],default:["seekbar"],right:["fullscreen","volume","hd-indicator"]};var r=t.options.src.match(u);return t._src=r&&r[7],t.YTPlayer=null,t.YT=null,(t.options.playback.controls||t.options.useVideoTagDefaultControls)&&t.$el.attr("controls",""),o.load((function(e){t.YT=e,t.setupYoutubePlayer()})),t}return n=y,(l=[{key:"name",get:function(){return"youtube_playback"}},{key:"template",get:function(){return e.template('<div id="<%=id%>"></div>')}},{key:"attributes",get:function(){return{"data-youtube-playback":"",class:"clappr-youtube-playback",id:this.cid}}},{key:"ended",get:function(){return!1}},{key:"buffering",get:function(){return this.YTPlayer&&this.YTPlayer.getPlayerState()===YT.PlayerState.BUFFERING}},{key:"isReady",get:function(){return this._ready}},{key:"setupYoutubePlayer",value:function(){var t=this;this.YT&&this.YT.Player?this.embedYoutubePlayer():this.once(e.Events.PLAYBACK_READY,(function(){return t.embedYoutubePlayer()})),this.options.playback&&this.options.playback.controls||this.enableMediaControl()}},{key:"embedYoutubePlayer",value:function(){var e=this,t={controls:0,autoplay:this.options.autoPlay?1:0,disablekb:1,enablejsapi:1,iv_load_policy:3,modestbranding:1,showinfo:0,html5:1,origin:window.location.host};this.YTPlayer=new this.YT.Player("yt".concat(this.cid),{videoId:this._src,playerVars:t,width:"100%",height:"100%",events:{onReady:function(){return e.ready()},onStateChange:function(t){return e.stateChange(t)},onPlaybackQualityChange:function(t){return e.qualityChange(t)},onError:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return onError(e)}))}})}},{key:"onError",value:function(t){var r;switch(t.data){case 2:e.Log.error("Youtube: Invalide parameter."),r=this.createError(t),this.trigger(e.Events.PLAYBACK_ERROR,r),this.stop();break;case 5:e.Log.error("Youtube: HTML5 player error."),r=this.createError(t),this.trigger(e.Events.PLAYBACK_ERROR,r),this.stop();break;case 100:e.Log.error("Youtube: Video not found."),r=this.createError(t),this.trigger(e.Events.PLAYBACK_ERROR,r),this.stop();break;default:e.Log.error("Youtube: Embed not allowed by user."),r=this.createError(t),this.trigger(e.Events.PLAYBACK_ERROR,r),this.stop()}}},{key:"ready",value:function(){this._ready=!0,this.options.autoPlay&&this.play(),this.trigger(e.Events.PLAYBACK_READY,this.name)}},{key:"qualityChange",value:function(t){this.trigger(e.Events.PLAYBACK_HIGHDEFINITIONUPDATE,this.isHighDefinitionInUse())}},{key:"stateChange",value:function(t){switch(t.data){case this.YT.PlayerState.PLAYING:var r=this.getPlaybackType();this._playbackType!==r&&(this.settings.changeCount++,this._playbackType=r,this.trigger(e.Events.PLAYBACK_SETTINGSUPDATE)),this.trigger(e.Events.PLAYBACK_BUFFERFULL),this.trigger(e.Events.PLAYBACK_PLAY);break;case this.YT.PlayerState.PAUSED:this.trigger(e.Events.PLAYBACK_PAUSE);break;case this.YT.PlayerState.BUFFERING:this.trigger(e.Events.PLAYBACK_BUFFERING);break;case this.YT.PlayerState.ENDED:this.options.youtubeShowRelated?this.disableMediaControl():this.trigger(e.Events.PLAYBACK_ENDED)}}},{key:"play",value:function(){var t=this;this.YTPlayer?(this._progressTimer=this._progressTimer||setInterval((function(){return t.progress()}),100),this._timeupdateTimer=this._timeupdateTimer||setInterval((function(){return t.timeupdate()}),100),this.YTPlayer.playVideo()):this._ready?(this.trigger(e.Events.PLAYBACK_BUFFERING),this._progressTimer=this._progressTimer||setInterval((function(){return t.progress()}),100),this._timeupdateTimer=this._timeupdateTimer||setInterval((function(){return t.timeupdate()}),100),this.setupYoutubePlayer()):(this.trigger(e.Events.PLAYBACK_BUFFERING),this.listenToOnce(this,e.Events.PLAYBACK_READY,this.play))}},{key:"pause",value:function(){clearInterval(this._timeupdateTimer),this._timeupdateTimer=null,this.YTPlayer&&this.YTPlayer.pauseVideo()}},{key:"seek",value:function(e){this.YTPlayer&&this.YTPlayer.seekTo(e)}},{key:"seekPercentage",value:function(e){if(this.YTPlayer){var t=e*this.YTPlayer.getDuration()/100;this.seekTo(t)}}},{key:"volume",value:function(e){this.YTPlayer&&this.YTPlayer.setVolume&&this.YTPlayer.setVolume(e)}},{key:"progress",value:function(){if(this.YTPlayer&&this.YTPlayer.getDuration){var t=this.YTPlayer.getDuration()*this.YTPlayer.getVideoLoadedFraction();this.trigger(e.Events.PLAYBACK_PROGRESS,{start:0,current:t,total:this.YTPlayer.getDuration()})}}},{key:"timeupdate",value:function(){this.YTPlayer&&this.YTPlayer.getDuration&&this.trigger(e.Events.PLAYBACK_TIMEUPDATE,{current:this.YTPlayer.getCurrentTime(),total:this.YTPlayer.getDuration()})}},{key:"isPlaying",value:function(){return this.YTPlayer&&this.YTPlayer.getPlayerState()==this.YT.PlayerState.PLAYING}},{key:"isHighDefinitionInUse",value:function(){return this.YTPlayer&&!!this.YTPlayer.getPlaybackQuality().match(/^hd\d+/)}},{key:"getDuration",value:function(){var e=0;return this.YTPlayer&&(e=this.YTPlayer.getDuration()),e}},{key:"getPlaybackType",value:function(){return e.Playback.VOD}},{key:"disableMediaControl",value:function(){this.$el.css({"pointer-events":"auto"}),this.trigger(e.Events.PLAYBACK_MEDIACONTROL_DISABLE)}},{key:"enableMediaControl",value:function(){this.$el.css({"pointer-events":"none"}),this.trigger(e.Events.PLAYBACK_MEDIACONTROL_ENABLE)}},{key:"render",value:function(){this.$el.html(this.template({id:"yt".concat(this.cid)}));var t=e.Styler.getStyleFor(s,{baseUrl:this.options.baseUrl});return this.$el.append(t),this}}])&&t(n.prototype,l),c&&t(n,c),y}(e.Playback);return l.canPlay=function(e){var t=e.match(u);return t&&11===t[7].length},l}));
